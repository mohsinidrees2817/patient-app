(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{208:(e,t,a)=>{Promise.resolve().then(a.t.bind(a,5795,23)),Promise.resolve().then(a.t.bind(a,9497,23)),Promise.resolve().then(a.t.bind(a,347,23)),Promise.resolve().then(a.bind(a,2717)),Promise.resolve().then(a.bind(a,3014)),Promise.resolve().then(a.bind(a,8455))},347:()=>{},2383:()=>{},2717:(e,t,a)=>{"use strict";a.d(t,{default:()=>o});var s=a(5155);a(2115);var n=a(6874),l=a.n(n),r=a(5695);let i=[{id:1,name:"Dashboard",path:"/"},{id:2,name:"History",path:"/history/"}],o=()=>{let e=(0,r.usePathname)();return(0,s.jsx)("div",{className:"shadow-sm shadow-[#f2f3f4]",children:(0,s.jsxs)("div",{className:"flex justify-between items-center   w-full bg-white py-3 px-8",children:[(0,s.jsx)("div",{className:"flex items-center space-x-2 w-full ",children:i.map(t=>(0,s.jsx)(l(),{href:t.path,className:"",children:(0,s.jsx)("span",{className:"px-2\n                  ".concat(e===t.path?"text-sm font-medium text-[#1e7be7] cursor-pointer  border-b-3 border-[#1e7be7] py-4.5":"text-sm font-medium text-black cursor-pointer py-4","\n                "),children:t.name})},t.id))}),(0,s.jsxs)("div",{className:"flex items-center space-x-6 mr-4 ",children:[(0,s.jsx)("p",{className:"font-light text-sm ",children:"Notifications"})," ",(0,s.jsx)("img",{className:"size-8 rounded-full",src:"https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80",alt:""})]})]})})}},3014:(e,t,a)=>{"use strict";a.d(t,{default:()=>r});var s=a(5155);a(2115);var n=a(9911),l=a(8455);let r=()=>{let{selectedFile:e,proccesingState:t,files:a,handleFileChange:r,handleFileSelect:i,handleDrop:o,handleRemoveFile:c,fileInputRef:m}=(0,l.A)(),d=e=>{if(!e||!e.name)return(0,s.jsx)(n.t69,{className:"text-gray-400 text-lg"});let t=e.type||"",a=e.name.toLowerCase();return"text/csv"===t||a.endsWith(".csv")?(0,s.jsx)(n.QaY,{className:"text-green-400 text-lg"}):t.includes("spreadsheet")||a.endsWith(".xls")||a.endsWith(".xlsx")?(0,s.jsx)(n.Ru,{className:"text-green-500 text-lg"}):(0,s.jsx)(n.t69,{className:"text-gray-400 text-lg"})};return(0,s.jsxs)("div",{className:"bg-[#20263e] max-w-[300px] w-full min-h-screen",children:[(0,s.jsx)("div",{className:"py-3 px-6 border-b border-[#2d345d]",children:(0,s.jsx)("img",{src:"/jupyterlab/default/proxy/8000/logo.png",alt:"Logo"})}),(0,s.jsxs)("div",{className:"py-6 px-6",children:[(0,s.jsx)("h1",{className:"font-[500] text-lg text-white",children:"UPLOAD DATA"}),(0,s.jsx)("p",{className:"text-xs py-1 text-[#a6a6a6]",children:"Upload documents you want to summarize"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex flex-col gap-3 justify-center items-center border border-[#3faaeb]/60 rounded-lg mt-4 border-dashed px-4 py-12 ".concat(t?"cursor-not-allowed":" cursor-pointer"," "),onClick:()=>document.getElementById("fileInput").click(),onDragOver:e=>e.preventDefault(),onDrop:o,children:[(0,s.jsx)("input",{type:"file",id:"fileInput",className:"hidden",ref:m,disabled:t,multiple:!0,accept:".csv, .xls, .xlsx",onChange:r}),(0,s.jsx)("svg",{fill:"#505b7e",height:"40px",width:"40px",viewBox:"0 0 374.116 374.116",xmlns:"http://www.w3.org/2000/svg",className:"mb-6",children:(0,s.jsxs)("g",{children:[(0,s.jsx)("path",{d:"M344.058,207.506c-16.568,0-30,13.432-30,30v76.609h-254v-76.609c0-16.568-13.432-30-30-30s-30,13.432-30,30v106.609c0,16.568,13.432,30,30,30h314c16.568,0,30-13.432,30-30V237.506C374.058,220.938,360.626,207.506,344.058,207.506z"}),(0,s.jsx)("path",{d:"M123.57,135.915l33.488-33.488v111.775c0,16.568,13.432,30,30,30c16.568,0,30-13.432,30-30V102.426l33.488,33.488 c5.857,5.858,13.535,8.787,21.213,8.787c7.678,0,15.355-2.929,21.213-8.787c11.716-11.716,11.716-30.71,0-42.426L208.271,8.788 c-11.715-11.717-30.711-11.717-42.426,0L81.144,93.489c-11.716,11.716-11.716,30.71,0,42.426 C92.859,147.631,111.855,147.631,123.57,135.915z"})]})}),(0,s.jsxs)("div",{className:"flex flex-col gap-1 items-center justify-center",children:[(0,s.jsx)("p",{className:"text-xs text-white",children:"Drag and drop files here"}),(0,s.jsx)("p",{className:"text-white py-1 text-sm",children:"-OR-"}),(0,s.jsx)("button",{className:"py-2 px-3 rounded-md text-white text-xs font-bold bg-gradient-to-r from-[#046dfd] via-blue-400 to-[#3cace6] ".concat(t?"cursor-not-allowed":" cursor-pointer"," "),onClick:e=>{e.stopPropagation(),document.getElementById("fileInput").click()},children:"Browse Files"})]})]}),a.length>0&&(0,s.jsxs)("div",{className:"mt-6 bg-[#303751] rounded-lg min-h-[200px] overflow-y-auto",children:[(0,s.jsx)("h3",{className:"text-white text-sm font-semibold px-3 py-2",children:"FILES"}),(0,s.jsx)("hr",{className:"border-1 border-[#3faaeb]/30 mb-2"}),(0,s.jsx)("ul",{className:'"text-white text-xs space-y-2 '.concat(t?"cursor-not-allowed":" cursor-pointer"),children:a.map((a,l)=>(0,s.jsxs)("li",{className:"flex items-center justify-between py-2 rounded-md px-2 relative  ".concat((null==e?void 0:e.name)===a.name?"bg-[#2d345d]":"","  ").concat(t?"cursor-not-allowed":" cursor-pointer"),onClick:()=>{t||i(a)},children:[(0,s.jsx)("button",{className:"text-red-400  text-lg mr-2 ".concat(t?"cursor-not-allowed":" cursor-pointer"),disabled:t,onClick:e=>{e.stopPropagation(),c(a)},children:"\xd7"}),(0,s.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,s.jsxs)("div",{className:"flex items-center".concat(t?"cursor-not-allowed":" cursor-pointer"),children:[d(a),(0,s.jsxs)("div",{className:"ml-2",children:[(0,s.jsx)("p",{className:"text-[12px] truncate text-white",children:a.name}),(0,s.jsxs)("p",{className:"text-[11px] text-white",children:[(a.size/1024).toFixed(2)," KB"]})]})]}),(0,s.jsx)("div",{className:"flex items-center",children:(null==e?void 0:e.name)===a.name&&(0,s.jsx)(n.CMH,{className:"text-green-400 text-lg mr-2"})})]})]},l))})]})]})]})]})}},3686:()=>{},8455:(e,t,a)=>{"use strict";a.d(t,{A:()=>m,MainProvider:()=>c});var s=a(5155),n=a(2115),l=a(408),r=a.n(l),i=a(3925);let o=(0,n.createContext)(),c=e=>{let{children:t}=e,[a,l]=(0,n.useState)([]),[c,m]=(0,n.useState)(null),[d,u]=(0,n.useState)([]),[p,f]=(0,n.useState)(!1),[x,h]=(0,n.useState)([]),g=(0,n.useRef)(null),[y,b]=(0,n.useState)({}),[v,w]=(0,n.useState)({}),j="/jupyterlab/default/proxy/8000",P=(0,n.useRef)({}),[N,D]=(0,n.useState)(null),[S,k]=(0,n.useState)(!1),E=["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],C=e=>new Promise(t=>{let a=new FileReader;a.onload=a=>{let{target:s}=a,n=[];if("text/csv"===e.type)r().parse(s.result,{header:!0,skipEmptyLines:!0,complete:e=>{t(e.data.map(e=>({...e,status:"Pending",summary:"",classification:""})))}});else if("application/vnd.ms-excel"===e.type||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type){let e=i.LF(s.result,{type:"binary"}),a=e.SheetNames[0],n=e.Sheets[a],l=i.Wp.sheet_to_json(n,{header:1}),r=l[0];t(l.slice(1).map(e=>{let t={};return r.forEach((a,s)=>{t[a]=e[s]}),{...t,status:"Pending",summary:"",classification:""}}))}else console.error("Unsupported file type:",e.type),t([])},"text/csv"===e.type?a.readAsText(e):a.readAsBinaryString(e)}),I=async e=>{let t=e.filter(e=>!a.some(t=>t.file.name===e.name&&t.file.size===e.size)||(console.warn("Skipping duplicate file: ".concat(e.name)),!1));if(0===t.length){console.warn("No new files to upload (all files are duplicates).");return}let s=await Promise.all(t.map(async e=>{let t=await C(e);return{file:e,status:"Pending",summary:"",classification:"",tableData:t}}));l(e=>[...e,...s]),m(t[0]),u(s[0].tableData)},T=async e=>{var t,s;console.log("Starting processing for file: ".concat(e.name)),P.current[e.name]={isPaused:!1};let n=a.find(t=>t.file.name===e.name);if(!n||"Pending"!==n.status){console.log("File: ".concat(e.name," is already processed or in progress")),console.log(n.status,"fileData.status");return}f(!0),l(t=>t.map(t=>t.file.name===e.name?{...t,status:"In Progress"}:t)),console.log("i am here");for(let t=0;t<n.tableData.length;t++){if(null===(s=P.current[e.name])||void 0===s?void 0:s.isPaused){console.log("Processing paused for file: ".concat(e.name));return}let a=n.tableData[t];if("Pending"!==a.status)continue;L(t,"In Progress");let r=await F(a,t,e);r&&(L(t,"Done"),A(t,r),l(a=>a.map(a=>a.file.name===e.name?{...a,tableData:a.tableData.map((e,a)=>a===t?{...e,status:"Done",summary:r}:e)}:a)))}(null===(t=P.current[e.name])||void 0===t?void 0:t.isPaused)||l(t=>t.map(t=>t.file.name===e.name?{...t,status:"Done"}:t)),f(!1)},F=async(e,t,a,s)=>{try{var n;let a=(null===(n=e.summary)||void 0===n?void 0:n.trim())||"";if(a)console.log("Using existing summary for patient ".concat(e["Patient ID"],":"),a);else{console.log("Fetching summary for patient ".concat(e["Patient ID"],"..."));let n=await fetch("".concat(j,"/stream-summary"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:s});if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));let l=n.body.getReader(),r=new TextDecoder;for(a="";;){let{done:e,value:s}=await l.read();if(e)break;let n=r.decode(s,{stream:!0});a+=n,A(t,a)}if(console.log("Final Summary for patient ".concat(e["Patient ID"],":"),a),!a.trim()){console.error("Empty summary received, skipping classification."),L(t,"Error: error generating summary");return}}console.log('Fetching classification for summary: "'.concat(a,'"'));let l=await fetch("".concat(j,"/classify?summary=").concat(encodeURIComponent(a)),{method:"GET",headers:{"Content-Type":"application/json"},signal:s});if(!l.ok)throw Error("HTTP error! status: ".concat(l.status));let r=l.body.getReader(),i=new TextDecoder,o="";for(;;){let{done:e,value:a}=await r.read();if(e)break;let s=i.decode(a,{stream:!0}).trim();console.log("chunk",s),o+=s,R(t,o)}L(t,"Done"),k(!1)}catch(e){"AbortError"===e.name?console.log("Streaming aborted by user"):(console.error("Error processing summary and classification:",e),L(t,"Error!"),A(t,""),R(t,""),l(e=>e.map(e=>e.file.name===a.name?{...e,tableData:e.tableData.map((e,a)=>a===t?{...e,status:"Error!",summary:"",classification:""}:e)}:e)))}},R=(e,t)=>{u(a=>a.map((a,s)=>s===e?{...a,classification:t}:a)),l(a=>a.map(a=>a.file.name===c.name?{...a,tableData:a.tableData.map((a,s)=>s===e?{...a,classification:t}:a)}:a))},A=(e,t)=>{u(a=>a.map((a,s)=>s===e?{...a,summary:t}:a)),l(a=>a.map(a=>a.file.name===c.name?{...a,tableData:a.tableData.map((a,s)=>s===e?{...a,summary:t}:a)}:a))},L=(e,t)=>{u(a=>a.map((a,s)=>s===e?{...a,status:t}:a)),l(a=>a.map(a=>a.file.name===c.name?{...a,tableData:a.tableData.map((a,s)=>s===e?{...a,status:t}:a)}:a))};return(0,n.useEffect)(()=>{N&&(T(N),D(null))},[N]),(0,s.jsx)(o.Provider,{value:{data:a,setData:l,selectedFile:c,setSelectedFile:m,tableData:d,setTableData:u,handleFileUpload:I,startStreaming:T,updateRowSummary:A,updateRowStatus:L,updateSummaryInGlobalState:(e,t,a)=>{l(s=>s.map(s=>s.file.name===e.name?{...s,status:"Pending",tableData:s.tableData.map((e,s)=>s===t?{...e,summary:a,classification:null,status:"Pending"}:e)}:s))},proccesingState:p,setProccesingState:f,files:x,setFiles:h,handleFileChange:e=>{let t=Array.from(e.target.files).filter(e=>E.includes(e.type));t.length>0&&(h(e=>[...e,...t]),I(t))},handleFileSelect:e=>{m(e);let t=a.find(t=>t.file.name===e.name);t&&u(t.tableData)},handleDrop:e=>{e.preventDefault();let t=Array.from(e.dataTransfer.files).filter(e=>E.includes(e.type));t.length>0&&(h(e=>[...e,...t]),l(e=>[...e,...t]))},handleRemoveFile:e=>{if(l(t=>t.filter(t=>t.file.name!==e.name)),h(t=>t.filter(t=>t.name!==e.name)),(null==c?void 0:c.name)===e.name){let t=a.filter(t=>t.file.name!==e.name);t.length>0?(m(t[0].file),u(t[0].tableData)):(m(null),u([]))}g.current&&(g.current.value="")},fileInputRef:g,startStreaming:T,stopProcessing:e=>{P.current[e.name]={isPaused:!0},k(!0),b(t=>({...t,[e.name]:{isPaused:!0}})),f(!1),l(t=>t.map(t=>t.file.name===e.name?{...t,status:"Pending"}:t))},restartProcessing:e=>{console.log("Restarting processing for file: ".concat(e.name)),P.current[e.name]={isPaused:!1},l(t=>t.map(t=>t.file.name===e.name?{...t,status:"Pending",tableData:t.tableData.map(e=>({...e,status:"Pending",summary:"",classification:""}))}:t)),u(e=>e.map(e=>({...e,status:"Pending",summary:"",classification:""}))),D(e)},proccesingState:p,fileProcessingState:y,startProcessing:e=>{console.log("Resuming processing for file: ".concat(e.name)),console.log(a,"data"),P.current[e.name]={isPaused:!1},b(t=>({...t,[e.name]:{isPaused:!1}}));let t=a.find(t=>t.file.name===e.name);t&&(t.tableData.some(e=>"Pending"===e.status)?T(e):console.log("No pending rows left to process for file: ".concat(e.name)))},stoppedProcessing:S},children:t})},m=()=>(0,n.useContext)(o)}},e=>{var t=t=>e(e.s=t);e.O(0,[830,711,524,217,900,441,684,358],()=>t(208)),_N_E=e.O()}]);