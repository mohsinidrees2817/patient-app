(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{162:(e,t,a)=>{Promise.resolve().then(a.bind(a,7850))},2383:()=>{},3686:()=>{},7850:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>i});var s=a(5155),l=a(2115),r=a(8455),n=a(9911),o=a(3925);function i(){let{selectedFile:e,tableData:t,setTableData:a,updateSummaryInGlobalState:i,startStreaming:d,stopProcessing:c,restartProcessing:m,proccesingState:u,startProcessing:p,stoppedProcessing:x}=(0,r.A)(),[f,b]=(0,l.useState)(null),[h,g]=(0,l.useState)(""),y=e=>{b(e),g(t[e].summary)};return(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-lg font-semibold text-black",children:"FILE PREVIEW"}),(0,s.jsx)("p",{className:"text-sm py-1 text-[#a6a6a6]",children:"Your uploaded file will be displayed here."})]}),e&&(0,s.jsx)("button",{onClick:()=>{if(0===t.length)return;let e=o.Wp.json_to_sheet(t),a=o.Wp.book_new();o.Wp.book_append_sheet(a,e,"Sheet1");let s=new Blob([o.M9(a,{bookType:"xlsx",type:"array"})],{type:"application/octet-stream"}),l=URL.createObjectURL(s),r=document.createElement("a");r.href=l,r.download="downloaded_data.xlsx",document.body.appendChild(r),r.click(),document.body.removeChild(r)},className:"py-3 px-3 rounded-md text-white text-xs font-bold bg-gradient-to-r from-[#046dfd] via-blue-400 to-[#3cace6] cursor-pointer",disabled:0===t.length,children:"Download File"})]}),t.length>0?(0,s.jsxs)("div",{className:"mt-4 overflow-x-auto bg-white   rounded-lg border border-[#e4e5e7] h-full ",children:[e&&(0,s.jsxs)("div",{className:"flex w-full justify-between items-center",children:[(0,s.jsx)("p",{className:"text-xl text-[#1e7ce7] rounded-t-2xl text-start py-4 px-4",children:null==e?void 0:e.name}),(0,s.jsxs)("div",{className:"flex gap-2 mr-4",children:[(0,s.jsx)("button",{onClick:()=>{p(e)},disabled:u||!1===t.some(e=>"Pending"===e.status),className:"py-3 px-3 rounded-md text-white text-xs font-bold bg-gradient-to-r from-green-500 to-green-400 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:"Start"}),(0,s.jsx)("button",{onClick:()=>{console.log("Stop Processing"),c(e)},disabled:!u,className:"py-3 px-3 rounded-md text-white text-xs font-bold bg-gradient-to-r from-red-500 to-red-400 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:x?"Stoping...":"Stop"}),(0,s.jsx)("button",{onClick:()=>{m(e)},disabled:u||x,className:"py-3 px-3 rounded-md text-white text-xs font-bold bg-gradient-to-r from-blue-500 to-blue-400 cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:"Restart"})]})]}),(0,s.jsxs)("div",{className:"border border-[#e4e5e7] rounded-t-2xl",children:[(0,s.jsx)("table",{className:"min-w-full text-white table-fixed",children:(0,s.jsx)("thead",{className:"bg-[#f3f2f7] text-sm text-start ",children:(0,s.jsxs)("tr",{children:[Object.keys(t[0]).slice(0,1).map((e,t)=>(0,s.jsx)("th",{className:"py-4 px-4 \n                            w-[200px] font-bold\n                         text-black border border-[#e4e5e7] text-start",children:e},t)),(0,s.jsx)("th",{className:"py-4 px-4 border border-[#e4e5e7] text-black text-start w-[150px]",children:"Status"}),(0,s.jsx)("th",{className:"py-4 px-4 border border-[#e4e5e7] text-black text-start",children:"Summary"}),(0,s.jsx)("th",{className:"py-4 px-4 border border-[#e4e5e7] text-black text-start w-[120px]",children:"Classification"})]})})}),(0,s.jsx)("div",{className:"max-h-[55vh] overflow-y-auto",children:(0,s.jsx)("table",{className:"min-w-full text-white table-fixed",children:(0,s.jsx)("tbody",{className:"text-sm",children:t.map((e,t)=>(0,s.jsxs)("tr",{className:"border-b border-[#e4e5e7] text-black relative w-[100px] ".concat(f===t?"bg-[#f3f6ff]":""),children:[Object.values(e).slice(0,1).map((e,t)=>(0,s.jsx)("td",{className:"py-4 px-4 \n                              w-[200px] font-bold\n                           text-black border border-[#e4e5e7] text-start",children:e},t)),(0,s.jsx)("td",{className:"items-center gap-2 py-4 px-4 border border-[#e4e5e7] text-black text-start w-[150px]",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"py-1 px-2 text-xs rounded-full ".concat("Pending"===e.status?"bg-red-500/40 text-red-600 font-bold":"In Progress"===e.status?"bg-blue-500/40 text-blue-600 font-bold":"bg-green-500/40 text-green-600 font-bold"),children:e.status}),"In Progress"===e.status&&(0,s.jsxs)("svg",{viewBox:"0 0 200 200",width:20,height:20,children:[(0,s.jsxs)("linearGradient",{id:"a11",children:[(0,s.jsx)("stop",{offset:"0",stopColor:"#2984FF",stopOpacity:"0"}),(0,s.jsx)("stop",{offset:"1",stopColor:"#2984FF"})]}),(0,s.jsx)("circle",{fill:"none",stroke:"url(#a11)",strokeWidth:"35",strokeLinecap:"round",strokeDasharray:"0 44 0 44 0 44 0 44 0 360",cx:"100",cy:"100",r:"70",transformOrigin:"center",children:(0,s.jsx)("animateTransform",{type:"rotate",attributeName:"transform",calcMode:"discrete",dur:"1",values:"360;324;288;252;216;180;144;108;72;36",repeatCount:"indefinite"})})]})]})}),(0,s.jsxs)("td",{className:"py-4 pl-6 pr-10 border border-[#e4e5e7] text-black text-start relative ",children:[e.summary,(e.classification||null===e.classification)&&(0,s.jsx)(n.uO9,{disabled:u,className:"absolute right-3 top-5 text-lg  transition-colors ".concat(f===t?"text-blue-500":"text-black/60","  disabled:opacity-80 ").concat(u?"cursor-not-allowed opacity-70":" cursor-pointer"," "),onClick:()=>{u||y(t)}})]}),(0,s.jsx)("td",{className:"py-4 px-4 border border-[#e4e5e7] text-black text-start w-[124px]",children:null==e?void 0:e.classification})]},t))})})})]}),null!==f&&(0,s.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:(0,s.jsxs)("div",{className:"relative min-w-[400px] max-w-[700px] w-full px-6 py-6 border border-[#eef0f3] rounded-md bg-white shadow-xl",children:[(0,s.jsx)("div",{className:"absolute right-3 top-3 cursor-pointer bg-red-400/30 px-2 py-1 text-xs rounded-full text-red-500",onClick:()=>{b(null),g("")},children:"X"}),(0,s.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,s.jsxs)("div",{className:"flex w-full justify-start items-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-[#f3f2f7] rounded-full flex justify-center items-center",children:(0,s.jsx)(n.uO9,{className:"text-xl text-blue-500"})}),(0,s.jsxs)("div",{className:"flex flex-col justify-start items-start ml-3",children:[(0,s.jsx)("p",{className:"font-semibold text-lg",children:"Edit Patient Summary"}),(0,s.jsx)("p",{className:"text-sm  text-[#a6a6a6]",children:"Modify the AI-generated summary before saving."})]})]}),(0,s.jsx)("input",{type:"text",value:h,onChange:e=>g(e.target.value),className:"w-full mt-6 p-2 text-black rounded-md border border-[#d2d4d9] focus:outline-none",placeholder:"Edit summary..."}),(0,s.jsxs)("div",{className:"flex justify-center gap-3 mt-4",children:[(0,s.jsx)("button",{onClick:()=>{g(t[f].summary)},className:"py-2 px-4 text-blue-500 border cursor-pointer border-blue-500 rounded-md font-bold text-sm hover:bg-blue-500 hover:text-white transition",children:"Reset"}),(0,s.jsx)("button",{onClick:()=>{null!==f&&(a(e=>e.map((e,t)=>t===f?{...e,summary:h,classification:null,status:"Pending"}:e)),i(e,f,h),b(null),g(""))},className:"py-2 px-4 bg-blue-500 text-white rounded-md font-bold text-sm hover:bg-blue-600 transition cursor-pointer",children:"Save Changes"})]})]})]})})]}):(0,s.jsx)("p",{className:"text-white mt-4",children:"No data available."})]})}},8455:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,MainProvider:()=>d});var s=a(5155),l=a(2115),r=a(408),n=a.n(r),o=a(3925);let i=(0,l.createContext)(),d=e=>{let{children:t}=e,[a,r]=(0,l.useState)([]),[d,c]=(0,l.useState)(null),[m,u]=(0,l.useState)([]),[p,x]=(0,l.useState)(!1),[f,b]=(0,l.useState)([]),h=(0,l.useRef)(null),[g,y]=(0,l.useState)({}),[j,v]=(0,l.useState)({}),w="/jupyterlab/default/proxy/8000",N=(0,l.useRef)({}),[P,k]=(0,l.useState)(null),[D,S]=(0,l.useState)(!1),C=["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],E=e=>new Promise(t=>{let a=new FileReader;a.onload=a=>{let{target:s}=a,l=[];if("text/csv"===e.type)n().parse(s.result,{header:!0,skipEmptyLines:!0,complete:e=>{t(e.data.map(e=>({...e,status:"Pending",summary:"",classification:""})))}});else if("application/vnd.ms-excel"===e.type||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type){let e=o.LF(s.result,{type:"binary"}),a=e.SheetNames[0],l=e.Sheets[a],r=o.Wp.sheet_to_json(l,{header:1}),n=r[0];t(r.slice(1).map(e=>{let t={};return n.forEach((a,s)=>{t[a]=e[s]}),{...t,status:"Pending",summary:"",classification:""}}))}else console.error("Unsupported file type:",e.type),t([])},"text/csv"===e.type?a.readAsText(e):a.readAsBinaryString(e)}),_=async e=>{let t=e.filter(e=>!a.some(t=>t.file.name===e.name&&t.file.size===e.size)||(console.warn("Skipping duplicate file: ".concat(e.name)),!1));if(0===t.length){console.warn("No new files to upload (all files are duplicates).");return}let s=await Promise.all(t.map(async e=>{let t=await E(e);return{file:e,status:"Pending",summary:"",classification:"",tableData:t}}));r(e=>[...e,...s]),c(t[0]),u(s[0].tableData)},R=async e=>{var t,s;console.log("Starting processing for file: ".concat(e.name)),N.current[e.name]={isPaused:!1};let l=a.find(t=>t.file.name===e.name);if(!l||"Pending"!==l.status){console.log("File: ".concat(e.name," is already processed or in progress")),console.log(l.status,"fileData.status");return}x(!0),r(t=>t.map(t=>t.file.name===e.name?{...t,status:"In Progress"}:t)),console.log("i am here");for(let t=0;t<l.tableData.length;t++){if(null===(s=N.current[e.name])||void 0===s?void 0:s.isPaused){console.log("Processing paused for file: ".concat(e.name));return}let a=l.tableData[t];if("Pending"!==a.status)continue;O(t,"In Progress");let n=await F(a,t,e);n&&(O(t,"Done"),I(t,n),r(a=>a.map(a=>a.file.name===e.name?{...a,tableData:a.tableData.map((e,a)=>a===t?{...e,status:"Done",summary:n}:e)}:a)))}(null===(t=N.current[e.name])||void 0===t?void 0:t.isPaused)||r(t=>t.map(t=>t.file.name===e.name?{...t,status:"Done"}:t)),x(!1)},F=async(e,t,a,s)=>{try{let a=await fetch("".concat(w,"/stream-summary?patient_id=").concat(e["Patient ID"]),{method:"GET",headers:{"Content-Type":"application/json"},signal:s});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let l=a.body.getReader(),r=new TextDecoder,n="";for(;;){let{done:e,value:a}=await l.read();if(e)break;let s=r.decode(a,{stream:!0});n+=s,I(t,n)}if(console.log("Final Summary for patient ".concat(e["Patient ID"],":"),n),!n.trim()){console.error("Empty summary received, skipping classification."),O(t,"Error: error generating summary");return}let o=await fetch("".concat(w,"/classify?summary=").concat(encodeURIComponent(n)),{method:"GET",headers:{"Content-Type":"application/json"},signal:s});if(!o.ok)throw Error("HTTP error! status: ".concat(o.status));let i=o.body.getReader(),d="";for(;;){let{done:e,value:a}=await i.read();if(e)break;let s=r.decode(a,{stream:!0}).trim();console.log("chunk",s),d+=s,T(t,d)}O(t,"Done"),S(!1)}catch(e){"AbortError"===e.name?console.log("Streaming aborted by user"):(console.error("Error processing summary and classification:",e),O(t,"Error!"),I(t,""),T(t,""),r(e=>e.map(e=>e.file.name===a.name?{...e,tableData:e.tableData.map((e,a)=>a===t?{...e,status:"Error!",summary:"",classification:""}:e)}:e)))}},T=(e,t)=>{u(a=>a.map((a,s)=>s===e?{...a,classification:t}:a)),r(a=>a.map(a=>a.file.name===d.name?{...a,tableData:a.tableData.map((a,s)=>s===e?{...a,classification:t}:a)}:a))},I=(e,t)=>{u(a=>a.map((a,s)=>s===e?{...a,summary:t}:a)),r(a=>a.map(a=>a.file.name===d.name?{...a,tableData:a.tableData.map((a,s)=>s===e?{...a,summary:t}:a)}:a))},O=(e,t)=>{u(a=>a.map((a,s)=>s===e?{...a,status:t}:a)),r(a=>a.map(a=>a.file.name===d.name?{...a,tableData:a.tableData.map((a,s)=>s===e?{...a,status:t}:a)}:a))};return(0,l.useEffect)(()=>{P&&(R(P),k(null))},[P]),(0,s.jsx)(i.Provider,{value:{data:a,setData:r,selectedFile:d,setSelectedFile:c,tableData:m,setTableData:u,handleFileUpload:_,startStreaming:R,updateRowSummary:I,updateRowStatus:O,updateSummaryInGlobalState:(e,t,a)=>{r(s=>s.map(s=>s.file.name===e.name?{...s,status:"Pending",tableData:s.tableData.map((e,s)=>s===t?{...e,summary:a,classification:null,status:"Pending"}:e)}:s))},proccesingState:p,setProccesingState:x,files:f,setFiles:b,handleFileChange:e=>{let t=Array.from(e.target.files).filter(e=>C.includes(e.type));t.length>0&&(b(e=>[...e,...t]),_(t))},handleFileSelect:e=>{c(e);let t=a.find(t=>t.file.name===e.name);t&&u(t.tableData)},handleDrop:e=>{e.preventDefault();let t=Array.from(e.dataTransfer.files).filter(e=>C.includes(e.type));t.length>0&&(b(e=>[...e,...t]),r(e=>[...e,...t]))},handleRemoveFile:e=>{if(r(t=>t.filter(t=>t.file.name!==e.name)),b(t=>t.filter(t=>t.name!==e.name)),(null==d?void 0:d.name)===e.name){let t=a.filter(t=>t.file.name!==e.name);t.length>0?(c(t[0].file),u(t[0].tableData)):(c(null),u([]))}h.current&&(h.current.value="")},fileInputRef:h,startStreaming:R,stopProcessing:e=>{N.current[e.name]={isPaused:!0},S(!0),y(t=>({...t,[e.name]:{isPaused:!0}})),x(!1),r(t=>t.map(t=>t.file.name===e.name?{...t,status:"Pending"}:t))},restartProcessing:e=>{console.log("Restarting processing for file: ".concat(e.name)),N.current[e.name]={isPaused:!1},r(t=>t.map(t=>t.file.name===e.name?{...t,status:"Pending",tableData:t.tableData.map(e=>({...e,status:"Pending",summary:"",classification:""}))}:t)),u(e=>e.map(e=>({...e,status:"Pending",summary:"",classification:""}))),k(e)},proccesingState:p,fileProcessingState:g,startProcessing:e=>{console.log("Resuming processing for file: ".concat(e.name)),console.log(a,"data"),N.current[e.name]={isPaused:!1},y(t=>({...t,[e.name]:{isPaused:!1}}));let t=a.find(t=>t.file.name===e.name);t&&(t.tableData.some(e=>"Pending"===e.status)?R(e):console.log("No pending rows left to process for file: ".concat(e.name)))},stoppedProcessing:D},children:t})},c=()=>(0,l.useContext)(i)}},e=>{var t=t=>e(e.s=t);e.O(0,[711,524,217,441,684,358],()=>t(162)),_N_E=e.O()}]);