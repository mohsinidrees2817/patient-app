(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2383:()=>{},3639:(e,t,a)=>{Promise.resolve().then(a.bind(a,7850))},3686:()=>{},7850:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(5155),l=a(2115),r=a(8455),n=a(9911),i=a(3925);function o(){let{selectedFile:e,tableData:t,setTableData:a,startStreaming:o,updateSummaryInGlobalState:d,proccesingState:c}=(0,r.A)(),[m,x]=(0,l.useState)(null),[p,u]=(0,l.useState)(""),f=e=>{x(e),u(t[e].summary)};return(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-lg font-semibold text-black",children:"FILE PREVIEW"}),(0,s.jsx)("p",{className:"text-sm py-1 text-[#a6a6a6]",children:"Your uploaded file will be displayed here."})]}),e&&(0,s.jsx)("button",{onClick:()=>{if(0===t.length)return;let e=i.Wp.json_to_sheet(t),a=i.Wp.book_new();i.Wp.book_append_sheet(a,e,"Sheet1");let s=new Blob([i.M9(a,{bookType:"xlsx",type:"array"})],{type:"application/octet-stream"}),l=URL.createObjectURL(s),r=document.createElement("a");r.href=l,r.download="downloaded_data.xlsx",document.body.appendChild(r),r.click(),document.body.removeChild(r)},className:"py-3 px-3 rounded-md text-white text-xs font-bold bg-gradient-to-r from-[#046dfd] via-blue-400 to-[#3cace6] cursor-pointer",disabled:0===t.length,children:"Download CSV"})]}),t.length>0?(0,s.jsxs)("div",{className:"mt-4 overflow-x-auto bg-white   rounded-lg border border-[#e4e5e7] h-full ",children:[e&&(0,s.jsxs)("div",{className:"flex w-full justify-between items-center ",children:[(0,s.jsx)("p",{className:"text-xl text-[#1e7ce7] rounded-t-2xl text-start py-4 px-4",children:null==e?void 0:e.name}),(0,s.jsx)("button",{onClick:()=>{console.log("Processing started"),o(e)},disabled:c||!1===t.some(e=>"Pending"===e.status),className:"py-3 px-3 rounded-md text-white text-xs font-bold bg-gradient-to-r from-[#046dfd] via-blue-400 to-[#3cace6] cursor-pointer mr-4 disabled:opacity-50 disabled:cursor-not-allowed ",children:c?"Processing...":"Start Processing"})]}),(0,s.jsxs)("div",{className:"border border-[#e4e5e7] rounded-t-2xl",children:[(0,s.jsx)("table",{className:"min-w-full text-white table-fixed",children:(0,s.jsx)("thead",{className:"bg-[#f3f2f7] text-sm text-start ",children:(0,s.jsxs)("tr",{children:[Object.keys(t[0]).slice(0,1).map((e,t)=>(0,s.jsx)("th",{className:"py-4 px-4 \n                            w-[200px] font-bold\n                         text-black border border-[#e4e5e7] text-start",children:e},t)),(0,s.jsx)("th",{className:"py-4 px-4 border border-[#e4e5e7] text-black text-start w-[150px]",children:"Status"}),(0,s.jsx)("th",{className:"py-4 px-4 border border-[#e4e5e7] text-black text-start",children:"Summary"}),(0,s.jsx)("th",{className:"py-4 px-4 border border-[#e4e5e7] text-black text-start w-[120px]",children:"Classification"})]})})}),(0,s.jsx)("div",{className:"max-h-[55vh] overflow-y-auto",children:(0,s.jsx)("table",{className:"min-w-full text-white table-fixed",children:(0,s.jsx)("tbody",{className:"text-sm",children:t.map((e,t)=>(0,s.jsxs)("tr",{className:"border-b border-[#e4e5e7] text-black relative w-[100px] ".concat(m===t?"bg-[#f3f6ff]":""),children:[Object.values(e).slice(0,1).map((e,t)=>(0,s.jsx)("td",{className:"py-4 px-4 \n                              w-[200px] font-bold\n                           text-black border border-[#e4e5e7] text-start",children:e},t)),(0,s.jsx)("td",{className:"items-center gap-2 py-4 px-4 border border-[#e4e5e7] text-black text-start w-[150px]",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("span",{className:"py-1 px-2 text-xs rounded-full ".concat("Pending"===e.status?"bg-red-500/40 text-red-600 font-bold":"In Progress"===e.status?"bg-blue-500/40 text-blue-600 font-bold":"bg-green-500/40 text-green-600 font-bold"),children:e.status}),"In Progress"===e.status&&(0,s.jsxs)("svg",{viewBox:"0 0 200 200",width:20,height:20,children:[(0,s.jsxs)("linearGradient",{id:"a11",children:[(0,s.jsx)("stop",{offset:"0",stopColor:"#2984FF",stopOpacity:"0"}),(0,s.jsx)("stop",{offset:"1",stopColor:"#2984FF"})]}),(0,s.jsx)("circle",{fill:"none",stroke:"url(#a11)",strokeWidth:"35",strokeLinecap:"round",strokeDasharray:"0 44 0 44 0 44 0 44 0 360",cx:"100",cy:"100",r:"70",transformOrigin:"center",children:(0,s.jsx)("animateTransform",{type:"rotate",attributeName:"transform",calcMode:"discrete",dur:"1",values:"360;324;288;252;216;180;144;108;72;36",repeatCount:"indefinite"})})]})]})}),(0,s.jsxs)("td",{className:"py-4 pl-6 pr-10 border border-[#e4e5e7] text-black text-start relative ",children:[e.summary,e.classification&&(0,s.jsx)(n.uO9,{disabled:c,className:"absolute right-3 top-5 text-lg  transition-colors ".concat(m===t?"text-blue-500":"text-black/60","  disabled:opacity-80 ").concat(c?"cursor-not-allowed opacity-70":" cursor-pointer"," "),onClick:()=>{c||f(t)}})]}),(0,s.jsx)("td",{className:"py-4 px-4 border border-[#e4e5e7] text-black text-start w-[124px]",children:null==e?void 0:e.classification})]},t))})})})]}),null!==m&&(0,s.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:(0,s.jsxs)("div",{className:"relative min-w-[400px] max-w-[700px] w-full px-6 py-6 border border-[#eef0f3] rounded-md bg-white shadow-xl",children:[(0,s.jsx)("div",{className:"absolute right-3 top-3 cursor-pointer bg-red-400/30 px-2 py-1 text-xs rounded-full text-red-500",onClick:()=>{x(null),u("")},children:"X"}),(0,s.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(0,s.jsxs)("div",{className:"flex w-full justify-start items-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 bg-[#f3f2f7] rounded-full flex justify-center items-center",children:(0,s.jsx)(n.uO9,{className:"text-xl text-blue-500"})}),(0,s.jsxs)("div",{className:"flex flex-col justify-start items-start ml-3",children:[(0,s.jsx)("p",{className:"font-semibold text-lg",children:"Edit Patient Summary"}),(0,s.jsx)("p",{className:"text-sm  text-[#a6a6a6]",children:"Modify the AI-generated summary before saving."})]})]}),(0,s.jsx)("input",{type:"text",value:p,onChange:e=>u(e.target.value),className:"w-full mt-6 p-2 text-black rounded-md border border-[#d2d4d9] focus:outline-none",placeholder:"Edit summary..."}),(0,s.jsxs)("div",{className:"flex justify-center gap-3 mt-4",children:[(0,s.jsx)("button",{onClick:()=>{u(t[m].summary)},className:"py-2 px-4 text-blue-500 border cursor-pointer border-blue-500 rounded-md font-bold text-sm hover:bg-blue-500 hover:text-white transition",children:"Reset"}),(0,s.jsx)("button",{onClick:()=>{null!==m&&(a(e=>e.map((e,t)=>t===m?{...e,summary:p,status:"Pending"}:e)),d(e,m,p),x(null),u(""))},className:"py-2 px-4 bg-blue-500 text-white rounded-md font-bold text-sm hover:bg-blue-600 transition cursor-pointer",children:"Save Changes"})]})]})]})})]}):(0,s.jsx)("p",{className:"text-white mt-4",children:"No data available."})]})}},8455:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,MainProvider:()=>d});var s=a(5155),l=a(2115),r=a(408),n=a.n(r),i=a(3925);let o=(0,l.createContext)(),d=e=>{let{children:t}=e,[a,r]=(0,l.useState)([]),[d,c]=(0,l.useState)(null),[m,x]=(0,l.useState)([]),[p,u]=(0,l.useState)(!1),[f,b]=(0,l.useState)([]),h=["text/csv","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],y=e=>new Promise(t=>{let a=new FileReader;a.onload=a=>{let{target:s}=a,l=[];if("text/csv"===e.type)n().parse(s.result,{header:!0,skipEmptyLines:!0,complete:e=>{t(e.data.map(e=>({...e,status:"Pending",summary:""})))}});else if("application/vnd.ms-excel"===e.type||"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"===e.type){let e=i.LF(s.result,{type:"binary"}),a=e.SheetNames[0],l=e.Sheets[a],r=i.Wp.sheet_to_json(l,{header:1}),n=r[0];t(r.slice(1).map(e=>{let t={};return n.forEach((a,s)=>{t[a]=e[s]}),{...t,status:"Pending",summary:""}}))}else console.error("Unsupported file type:",e.type),t([])},"text/csv"===e.type?a.readAsText(e):a.readAsBinaryString(e)}),g=async e=>{let t=e.filter(e=>!a.some(t=>t.file.name===e.name&&t.file.size===e.size)||(console.warn("Skipping duplicate file: ".concat(e.name)),!1));if(0===t.length){console.warn("No new files to upload (all files are duplicates).");return}let s=await Promise.all(t.map(async e=>{let t=await y(e);return{file:e,status:"Pending",summary:"",tableData:t}}));r(e=>[...e,...s]),c(t[0]),x(s[0].tableData)},j=async e=>{let t=a.find(t=>t.file.name===e.name);if(t&&"Pending"===t.status){u(!0),r(t=>t.map(t=>t.file.name===e.name?{...t,status:"In Progress"}:t));for(let a=0;a<t.tableData.length;a++){let s=t.tableData[a];if("Done"===s.status)continue;k(a,"In Progress");let l=await v(s,a,e);l&&(k(a,"Done"),N(a,l),r(t=>t.map(t=>t.file.name===e.name?{...t,tableData:t.tableData.map((e,t)=>t===a?{...e,status:"Done",summary:l}:e)}:t)))}r(t=>t.map(t=>t.file.name===e.name?{...t,status:"Done"}:t)),u(!1)}},v=async(e,t,a)=>{try{let a=await fetch("".concat("/jupyterlab/default/proxy/8000","/generate-summary"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let s=a.body.getReader(),l=new TextDecoder,r="",n="";for(;;){let{done:e,value:a}=await s.read();if(e)break;let i=l.decode(a,{stream:!0});if(i.includes("summary:")){let e=i.replace("summary:","").trim();r+=e+" ",N(t,r)}else if(i.includes("classification:")){let e=i.replace("classification:","").trim();n+=e+" ",w(t,n)}}k(t,"Done")}catch(e){console.error("Error streaming summary:",e),k(t,"Error!"),N(t,""),w(t,""),r(e=>e.map(e=>e.file.name===a.name?{...e,tableData:e.tableData.map((e,a)=>a===t?{...e,status:"Error!",summary:"",classification:""}:e)}:e))}},w=(e,t)=>{x(a=>a.map((a,s)=>s===e?{...a,classification:t}:a)),r(a=>a.map(a=>a.file.name===d.name?{...a,tableData:a.tableData.map((a,s)=>s===e?{...a,classification:t}:a)}:a))},N=(e,t)=>{x(a=>a.map((a,s)=>s===e?{...a,summary:t}:a)),r(a=>a.map(a=>a.file.name===d.name?{...a,tableData:a.tableData.map((a,s)=>s===e?{...a,summary:t}:a)}:a))},k=(e,t)=>{x(a=>a.map((a,s)=>s===e?{...a,status:t}:a)),r(a=>a.map(a=>a.file.name===d.name?{...a,tableData:a.tableData.map((a,s)=>s===e?{...a,status:t}:a)}:a))};return(0,s.jsx)(o.Provider,{value:{data:a,setData:r,selectedFile:d,setSelectedFile:c,tableData:m,setTableData:x,handleFileUpload:g,startStreaming:j,updateRowSummary:N,updateRowStatus:k,updateSummaryInGlobalState:(e,t,a)=>{r(s=>s.map(s=>s.file.name===e.name?{...s,status:"Pending",tableData:s.tableData.map((e,s)=>s===t?{...e,summary:a,status:"Pending"}:e)}:s))},proccesingState:p,setProccesingState:u,files:f,setFiles:b,handleFileChange:e=>{let t=Array.from(e.target.files).filter(e=>h.includes(e.type));t.length>0&&(b(e=>[...e,...t]),g(t))},handleFileSelect:e=>{c(e);let t=a.find(t=>t.file.name===e.name);t&&x(t.tableData)},handleDrop:e=>{e.preventDefault();let t=Array.from(e.dataTransfer.files).filter(e=>h.includes(e.type));t.length>0&&(b(e=>[...e,...t]),r(e=>[...e,...t]))},handleRemoveFile:e=>{if(r(t=>t.filter(t=>t.file.name!==e.name)),b(t=>t.filter(t=>t.name!==e.name)),(null==d?void 0:d.name)===e.name){let t=a.filter(t=>t.file.name!==e.name);t.length>0?(c(t[0].file),x(t[0].tableData)):(c(null),x([]))}}},children:t})},c=()=>(0,l.useContext)(o)}},e=>{var t=t=>e(e.s=t);e.O(0,[711,524,217,441,684,358],()=>t(3639)),_N_E=e.O()}]);